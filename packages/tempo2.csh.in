#!/bin/csh -ef

# @configure_input@

setenv TEMPO2 @prefix@/tempo2

mkdir -p @prefix@/src
cd @prefix@/src

if ( ! -d tempo2 ) then

  echo "Downloading TEMPO2 source code"

  touch $HOME/.cvspass
  setenv TEMPO2_CVS anonymous@tempo2.cvs.sourceforge.net:/cvsroot/tempo2

  echo "When prompted for CVS password: <ENTER>"

  cvs -d :pserver:$TEMPO2_CVS login
  cvs -z3 -d:pserver:$TEMPO2_CVS co -P tempo2

endif

cd tempo2

mkdir -p $TEMPO2
rsync -t T2runtime/* $TEMPO2

# use the same Fortran compiler
perl -pi -e 's/FC = g77/FC = @F77@/' Makefile.config

# don't compile the plugins

make tempo2 libtempo2pred.a

mkdir -p $TEMPO2/lib
mkdir -p $TEMPO2/include

cp -p libtempo2pred.a libtempo2.a sofa/libsofa.a $TEMPO2/lib
cp -p tempo2.h tempo2pred.h tempo2pred_int.h $TEMPO2/include

echo
echo
echo "TEMPO2 library installation completed"
echo
echo "To use the library, please set the environment variable"
echo
echo 'setenv TEMPO2 @prefix@/tempo2'
echo
echo "and then re-run the PSRCHIVE configure script"
echo
